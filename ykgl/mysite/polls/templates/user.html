{% extends 'pages/base.html' %}
 
{% block title %}域控管理系统 V1.0{% endblock %}
 

{% block content %}

<div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">域控管理系统</a>
            </div>
            <!-- /.navbar-header -->

           

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        
                         <li><i ><br/><br/></></i></li>
                         <li><i ><br/><br/></i></li>
                        <li>
                            <a href="index.html"><i class="fa fa-dashboard fa-fw"></i> 主页</a>
                        </li>
                        
                        <li>
                            <a href="home.html"><i class="fa fa-table fa-fw"></i> 授权管理</a>
                        </li>
                        <li>
                            <a href="user.html"><i class="fa fa-table fa-fw"></i> 用户管理</a>
                        </li>
                        <!--  
                        <li>
                            <a href="forms.html"><i class="fa fa-edit fa-fw"></i> Forms</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-wrench fa-fw"></i> UI Elements<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="panels-wells.html">Panels and Wells</a>
                                </li>
                                <li>
                                    <a href="buttons.html">Buttons</a>
                                </li>
                                <li>
                                    <a href="notifications.html">Notifications</a>
                                </li>
                                <li>
                                    <a href="typography.html">Typography</a>
                                </li>
                                <li>
                                    <a href="icons.html"> Icons</a>
                                </li>
                                <li>
                                    <a href="grid.html">Grid</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level 
                        </li>
                        -->
                       
                        
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
        
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header" id="header">欢迎登陆域控管理系统</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>            
                      
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                    	<!--
                        <div class="panel-heading" id="quotes_life">
                          	人生格言： 人生永无止境
                        </div>
                        <div class="panel-heading" id="quotes_invest">
                          	 投资格言： 投资永无止境
                        </div>-->
                        <!-- /.panel-heading -->
                        <div class="panel-body" id = "table_data">
                        		<h1>添加用户</h1>
                            <form role="form">
                                <fieldset >
                                    <div class="form-group  has-error">
                                       	 用户名：<font color='red'>一般为用户姓名全拼</font><input class="form-control" id="user_add" type="text" placeholder="不能与已有用户重名.." >
                                       	密      码：<font color='red'>包含特殊字符、字符或者数字，以字母开头，10到50个字符</font><input type="text" class="form-control" id="password_add" placeholder="密码.." >
                                       	姓：<input class="form-control" id="first_name" type="text" placeholder="用户的姓.." >
                                       	名：<input type="text" class="form-control" id="last_name" placeholder="用户的名字.." >
                                       	 
                                    </div>
                                    <!--  
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox">Disabled Checkbox
                                        </label>
                                    </div>-->
                                    <button type="button" class="btn btn-primary" onclick="create_user()">添加</button>
                                </fieldset>
                            </form>
                            <h1>删除用户</h1>
                            <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
                                <thead>
                                    <tr>
                                        <th>用户</th>                                       
                                        <th>删除</th>
                                        <th>禁用</th>
                                        <th>启用</th>
                                        
                                    </tr>
                                </thead>
                                <tbody id="table_data_body">
                                	{% for user in users %}
		                                
														        		<td class="center"><b>{{user}}</b></td>														        	
																		    <td class="center">
																		    	<button type="button" id="button-delete-{{user}}" class="btn btn-danger"  onclick="delete_user('{{user}}')" >删除用户</button>																		    	
																		    </td>
																		     <td class="center">
																		    	<button type="button" id="button-forbidden-{{user}}" class="btn btn-danger"  onclick="forbidden_user('{{user}}')" >禁用用户</button>
																		    	</td>
																		     <td class="center">
																		    	<button type="button" id="button-active-{{user}}" class="btn btn-success"  onclick="active_user('{{user}}')" >启用用户</button>
																		    	</td>
																		    <!--
																		    <td class="center">																		    	
																		    	<button type="button" class="btn btn-success"  onclick="cancel('{{user}}')" >取消授权</button>   
																		    </td>-->
													        		</tr>
												        	{% endfor %}
                                    
                                </tbody>
                            </table>
                            <!-- /.table-responsive 
                            <div class="well">
                                <h4>DataTables Usage Information</h4>
                                <p>DataTables is a very flexible, advanced tables plugin for jQuery. In SB Admin, we are using a specialized version of DataTables built for Bootstrap 3. We have also customized the table headings to use Font Awesome icons in place of images. For complete documentation on DataTables, visit their website at <a target="_blank" href="https://datatables.net/">https://datatables.net/</a>.</p>
                                <a class="btn btn-default btn-lg btn-block" target="_blank" href="https://datatables.net/">View DataTables Documentation</a>
                            </div>
                            -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                    
                    
                </div>
                <!-- /.col-lg-12 -->
            </div>
             
        <!--<button type="button" class="btn btn-danger"  onclick="getData()" id="refresh">刷新</button>-->   
        </div>
        
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->
	
	

	
	<script>
		$('#dataTables-example').DataTable({
	    	"autoWidth": true,//自适应宽度	    
	    	 "jQueryUI": true,
	         "responsive": true,
	         "processing": true,
	         "bSort": true, //是否支持排序功能
	         "oLanguage": {
	             "sLengthMenu": "每页显示 _MENU_ 条记录",
	             "sZeroRecords": "对不起，查询不到任何相关数据",
	             "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
	             "sInfoEmtpy": "找不到相关数据",
	             "sInfoFiltered": "数据表中共为 _MAX_ 条记录)",
	             "sProcessing": "正在加载中...",
	             "sSearch": "搜索",
	             "sUrl": "", //多语言配置文件，可将oLanguage的设置放在一个txt文件中，例：Javascript/datatable/dtCH.txt
	             "oPaginate": {
	                 "sFirst": "第一页",
	                 "sPrevious": " 上一页 ",
	                 "sNext": " 下一页 ",
	                 "sLast": " 最后一页 "
	             }
	         }
        });
			//添加输入框动作
			$("#user_add").bind('input propertychange',function(){
					$("#password_add").val($("#user_add").val().substring(0,6)+'@607');
				});
		
			function create_user(){				
		    var user = $("#user_add").val();
		    if(user.length<2){
		    	alert('用户名['+user+']长度小于2，请重新输入用户名！');
		    	return;
		    }
				var password = $("#password_add").val();
				var reg = /(?=.*\d)(?=.*[a-zA-Z])(?=.*^[a-zA-Z0-9]).{10,50}/;
				if(!reg.test(password)){
					alert('密码['+password+']不合规范，请重新输入密码！');
					return;
				}
				var fn = $("#first_name").val();
				//alert('fn:'+fn)
				var ln = $("#last_name").val();
				//alert('ln:'+ln)
				var r = confirm('请确认您已经了解添加用户['+user+']的效果（用户不能重名），再确认！');
				
				if(r==true){
					url = "create/?useri="+user+'&passwordi='+password+'&first_name='+fn+'&last_name='+ln; 
					$.get(url, function(data){	
						if(data=='ok'){					
							alert('成功添加用户['+user+']['+password+']');
							//跳转一下，刷新用户
							$(window).attr('location','user.html');
						}else
							alert('添加用户['+user+']['+password+']失败,请检查是否满足域控服务器要求！');
					});
				}
				/*
				$.confirm({
					title:'添加用户',
					content:'请确认您添加了正确的用户（用户不能重名），再确认！'
					
					confirm:function(){
						
						url = "create/?user="+user; 
						$.get(url, function(data){						
							alert('成功添加用户['+user+']');
						});
					},
					cancel:function(){
						//alert('您的慎重是有道理的！');
					}
				});*/
			}
			
			function delete_user(user){		
				var r = confirm('请确认您已经了解删除用户['+user+']的后果（用户配置不可恢复），再确认！');
				
				if(r==true){
					url = "delete/?useri="+user; 
					$.get(url, function(data){	
						if(data=='ok'){					
							var id = 	"#button-delete-"+user;	
							$(id).attr("disabled",true);
							id = "#button-forbidden-"+user
							$(id).attr("disabled",true);
							id = "#button-active-"+user;
							$(id).attr("disabled",true);			
							alert('成功删除用户['+user+']');
						}else{
							alert('删除用户['+user+']失败');
							}
					});
				}
				/*
				$.confirm({
					title:'删除用户',
					content:'请确认您已经了解删除用户的后果（用户配置不可恢复），再确认！',
					confirm:function(){
						url = "delete/?user="+user; 
						$.get(url, function(data){						
							alert('成功删除用户['+user+']');
						});
					},
					cancel:function(){
						alert('您的慎重是有道理的！');
					}
								
				});
				*/
			}
			
			function forbidden_user(user){	
				var r = confirm('请确认您已经了解禁用用户['+user+']的后果（用户配置不可恢复），再确认！');
				
				if(r==true){
					url = "forbidden/?useri="+user; 
					$.get(url, function(data){	
						if(data=='ok'){		
							var id = 	"#button-forbidden-"+user;		
							$(id).attr("disabled",true);
							id = "#button-active-"+user;
							$(id).attr("disabled",false);
							alert('成功禁用用户['+user+']');
						}else{
							alert('禁用用户['+user+']失败');
						}
					});
				}
			}
			
			function active_user(user){	
				var r = confirm('请确认您已经了解启用用户['+user+']的后果，再确认！');
				
				if(r==true){
					url = "active_user/?useri="+user; 
					$.get(url, function(data){	
						if(data=='ok'){
							var id = 	"#button-forbidden-"+user;		
							$(id).attr("disabled",false);
							id = "#button-active-"+user;
							$(id).attr("disabled",true);		
							alert('成功启用用户['+user+']');
						}else{
							alert('启用用户['+user+']失败');
						}
					});
				}
			}
			
		</script>

	

{% endblock %}
	

